/*!
 * treejs
 * @version 1.0.2
 * @see https://github.com/daweilv/treejs
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Tree=t():e.Tree=t()}(window,function(){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var n,o=(n=s(1))&&n.__esModule?n:{default:n};function a(e,t){this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this._willUpdateNodesById={},this.container=e,this.options=Object.assign({selectMode:"checkbox",values:[],beforeLoad:null,loaded:null,url:null,method:"GET"},t),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(e){return this.setValues((t={},s=[],e.forEach(function(e){t[e]||(t[e]=!0,s.push(e))}),s));var t,s}},selectedNodes:{get:function(){var e=[],t=this.nodesById;for(var s in t)if(t.hasOwnProperty(s)&&(1===t[s].status||2===t[s].status)){var n=Object.assign({},t[s]);delete n.parent,e.push(n)}return e}}}),this.options.url?this.init():this.load(this.options.data)}s(2),a.prototype.init=function(){var e=this,t=this.options,s=t.url,n=t.method,a=t.beforeLoad;(0,o.default)({url:s,method:n,success:function(t){var s=t;a&&(s=a(t)),e.load(s)}})},a.prototype.load=function(e){console.time("load");var t=a.parseTreeData(e),s=t.treeNodes,n=t.nodesById,o=t.leafNodesById,r=t.defaultValues;this.treeNodes=s,this.nodesById=n,this.leafNodesById=o;var i=this.render(this.treeNodes);this.bindEvent(i);var d=document.querySelector(this.container);d.appendChild(i,d);var l=this.options,c=l.values,u=l.loaded;c&&c.length&&(r=c),r.length&&this.setValues(r),u&&u.call(this),console.timeEnd("load")},a.prototype.render=function(e){var t=a.createRootEle();return t.appendChild(this.buildTree(e)),t},a.prototype.buildTree=function(e){var t=this,s=a.createUlEle();return e&&e.length&&e.forEach(function(e){var n=a.createLiEle(e);t.liElementsById[e.id]=n;var o=null;e.children&&e.children.length&&(o=t.buildTree(e.children)),o&&n.appendChild(o),s.appendChild(n)}),s},a.prototype.bindEvent=function(e){var t=this;e.addEventListener("click",function(e){var s=e.target;"SPAN"===s.nodeName&&s.classList.contains("treejs-checkbox")?t.onItemClick(s.parentNode.nodeId):"LI"===s.nodeName&&s.classList.contains("treejs-node")?t.onItemClick(s.nodeId):"SPAN"===s.nodeName&&s.classList.contains("treejs-switcher")&&t.onSwitcherClick(s)},!1)},a.prototype.onItemClick=function(e){console.time("onItemClick"),this.setValue(e),this.updateLiElements(),console.timeEnd("onItemClick")},a.prototype.setValue=function(e){var t=this.nodesById[e];if(t){var s=t.status,n=1===s||2===s?0:2;t.status=n,this.markWillUpdateNode(t),this.walkUp(t),this.walkDown(t)}},a.prototype.getValues=function(){var e=[];for(var t in this.leafNodesById)this.leafNodesById.hasOwnProperty(t)&&(1!==this.leafNodesById[t].status&&2!==this.leafNodesById[t].status||e.push(t));return e},a.prototype.setValues=function(e){var t=this;this.emptyNodesCheckStatus(),e.forEach(function(e){t.setValue(e)}),this.updateLiElements()},a.prototype.emptyNodesCheckStatus=function(){var e=this._willUpdateNodesById=this.getSelectedNodesById();for(var t in e)e.hasOwnProperty(t)&&(e[t].status=0)},a.prototype.getSelectedNodesById=function(){var e={},t=this.nodesById;for(var s in t)!t.hasOwnProperty(s)||1!==t[s].status&&2!==t[s].status||(e[s]=t[s]);return e},a.prototype.updateLiElements=function(){var e=this._willUpdateNodesById;for(var t in e)e.hasOwnProperty(t)&&this.updateLiElement(t,e[t].status);this._willUpdateNodesById={}},a.prototype.markWillUpdateNode=function(e){this._willUpdateNodesById[e.id]=e},a.prototype.onSwitcherClick=function(e){var t=e.parentNode,s=t.lastChild;if(t.classList.contains("treejs-node__close"))t.classList.remove("treejs-node__close"),s.style.height="auto";else{var n=getComputedStyle(s).height;s.style.height=n,setTimeout(function(){s.style.height="0px"}),t.classList.add("treejs-node__close")}},a.prototype.walkUp=function(e){var t=e.parent;if(t){var s=null,n=0;t.children.forEach(function(e){isNaN(e.status)||(n+=e.status)}),s=n?n===2*t.children.length?2:1:0,t.status!==s&&(t.status=s,this.markWillUpdateNode(t),this.walkUp(t))}},a.prototype.walkDown=function(e){var t=this;e.children&&e.children.length&&e.children.forEach(function(s){s.status=e.status,t.markWillUpdateNode(s),t.walkDown(s)})},a.prototype.updateLiElement=function(e,t){var s=this.liElementsById[e].classList;switch(t){case 0:s.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:s.remove("treejs-node__checked"),s.add("treejs-node__halfchecked");break;case 2:s.remove("treejs-node__halfchecked"),s.add("treejs-node__checked")}},a.parseTreeData=function(e){var t,s=(t=e,JSON.parse(JSON.stringify(t))),n={},o={},a=[];return function e(t,s){t.forEach(function(t){n[t.id]=t,t.checked&&a.push(t.id),s&&(t.parent=s),t.children&&t.children.length?e(t.children,t):o[t.id]=t})}(s),{treeNodes:s,nodesById:n,leafNodesById:o,defaultValues:a}},a.createRootEle=function(){var e=document.createElement("div");return e.classList.add("treejs"),e},a.createUlEle=function(){var e=document.createElement("ul");return e.classList.add("treejs-nodes"),e},a.createLiEle=function(e){var t=document.createElement("li");if(t.classList.add("treejs-node"),e.children&&e.children.length){var s=document.createElement("span");s.classList.add("treejs-switcher"),t.appendChild(s)}else t.classList.add("treejs-placeholder");var n=document.createElement("span");n.classList.add("treejs-checkbox"),t.appendChild(n);var o=document.createTextNode(e.text);return t.appendChild(o),t.nodeId=e.id,t}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={method:"GET",url:"",async:!0,success:null,failed:null,"Content-Type":"application/json; charset=utf-8"},s=Object.assign(t,e),n=new XMLHttpRequest,o=[];for(var a in s.data)s.data.hasOwnProperty(a)&&o.push(a+"="+s.data[a]);var r=o.join("&");"POST"===s.method.toUpperCase()?(n.open(s.method,s.url,s.async),n.setRequestHeader("Content-Type",s["Content-Type"]),n.send(r)):"GET"===s.method.toUpperCase()&&(n.open(s.method,s.url+"?"+r,s.async),n.setRequestHeader("Content-Type",s["Content-Type"]),n.send(null));n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=n.responseText;s["Content-Type"]===t["Content-Type"]&&(e=JSON.parse(e)),s.success&&s.success(e)}else s.failed&&s.failed(n.status)}}},function(e,t,s){}]).default});
//# sourceMappingURL=tree.min.js.map