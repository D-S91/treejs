/*!
 * treejs
 * @version 1.1.0
 * @see https://github.com/daweilv/treejs
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Tree=t():e.Tree=t()}(window,function(){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var n,o=(n=s(1))&&n.__esModule?n:{default:n};function r(e,t){this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this._willUpdateNodesById={},this.container=e,this.options=Object.assign({selectMode:"checkbox",values:[],beforeLoad:null,loaded:null,url:null,method:"GET"},t),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(e){return this.setValues((t={},s=[],e.forEach(function(e){t[e]||(t[e]=!0,s.push(e))}),s));var t,s}},selectedNodes:{get:function(){var e=[],t=this.nodesById;for(var s in t)if(t.hasOwnProperty(s)&&(1===t[s].status||2===t[s].status)){var n=Object.assign({},t[s]);delete n.parent,e.push(n)}return e}}}),this.options.url?this.init():this.load(this.options.data)}s(2),r.prototype.init=function(){var e=this,t=this.options,s=t.url,n=t.method,r=t.beforeLoad;(0,o.default)({url:s,method:n,success:function(t){var s=t;r&&(s=r(t)),e.load(s)}})},r.prototype.load=function(e){console.time("load");var t=r.parseTreeData(e),s=t.treeNodes,n=t.nodesById,o=t.leafNodesById,a=t.defaultValues;this.treeNodes=s,this.nodesById=n,this.leafNodesById=o;var i=this.render(this.treeNodes);this.bindEvent(i);var d=document.querySelector(this.container);!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(d),d.appendChild(i);var l=this.options,c=l.values,u=l.loaded;c&&c.length&&(a=c),a.length&&this.setValues(a),u&&u.call(this),console.timeEnd("load")},r.prototype.render=function(e){var t=r.createRootEle();return t.appendChild(this.buildTree(e)),t},r.prototype.buildTree=function(e){var t=this,s=r.createUlEle();return e&&e.length&&e.forEach(function(e){var n=r.createLiEle(e);t.liElementsById[e.id]=n;var o=null;e.children&&e.children.length&&(o=t.buildTree(e.children)),o&&n.appendChild(o),s.appendChild(n)}),s},r.prototype.bindEvent=function(e){var t=this;e.addEventListener("click",function(e){var s=e.target;"SPAN"===s.nodeName&&s.classList.contains("treejs-checkbox")?t.onItemClick(s.parentNode.nodeId):"LI"===s.nodeName&&s.classList.contains("treejs-node")?t.onItemClick(s.nodeId):"SPAN"===s.nodeName&&s.classList.contains("treejs-switcher")&&t.onSwitcherClick(s)},!1)},r.prototype.onItemClick=function(e){console.time("onItemClick"),this.setValue(e),this.updateLiElements(),console.timeEnd("onItemClick")},r.prototype.setValue=function(e){var t=this.nodesById[e];if(t){var s=t.status,n=1===s||2===s?0:2;t.status=n,this.markWillUpdateNode(t),this.walkUp(t),this.walkDown(t)}},r.prototype.getValues=function(){var e=[];for(var t in this.leafNodesById)this.leafNodesById.hasOwnProperty(t)&&(1!==this.leafNodesById[t].status&&2!==this.leafNodesById[t].status||e.push(t));return e},r.prototype.setValues=function(e){var t=this;this.emptyNodesCheckStatus(),e.forEach(function(e){t.setValue(e)}),this.updateLiElements()},r.prototype.emptyNodesCheckStatus=function(){var e=this._willUpdateNodesById=this.getSelectedNodesById();for(var t in e)e.hasOwnProperty(t)&&(e[t].status=0)},r.prototype.getSelectedNodesById=function(){var e={},t=this.nodesById;for(var s in t)!t.hasOwnProperty(s)||1!==t[s].status&&2!==t[s].status||(e[s]=t[s]);return e},r.prototype.updateLiElements=function(){var e=this._willUpdateNodesById;for(var t in e)e.hasOwnProperty(t)&&this.updateLiElement(t,e[t].status);this._willUpdateNodesById={}},r.prototype.markWillUpdateNode=function(e){this._willUpdateNodesById[e.id]=e},r.prototype.onSwitcherClick=function(e){var t=e.parentNode,s=t.lastChild;if(t.classList.contains("treejs-node__close"))t.classList.remove("treejs-node__close"),s.style.height="auto";else{var n=getComputedStyle(s).height;s.style.height=n,setTimeout(function(){s.style.height="0px"}),t.classList.add("treejs-node__close")}},r.prototype.walkUp=function(e){var t=e.parent;if(t){var s=null,n=0;t.children.forEach(function(e){isNaN(e.status)||(n+=e.status)}),s=n?n===2*t.children.length?2:1:0,t.status!==s&&(t.status=s,this.markWillUpdateNode(t),this.walkUp(t))}},r.prototype.walkDown=function(e){var t=this;e.children&&e.children.length&&e.children.forEach(function(s){s.status=e.status,t.markWillUpdateNode(s),t.walkDown(s)})},r.prototype.updateLiElement=function(e,t){var s=this.liElementsById[e].classList;switch(t){case 0:s.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:s.remove("treejs-node__checked"),s.add("treejs-node__halfchecked");break;case 2:s.remove("treejs-node__halfchecked"),s.add("treejs-node__checked")}},r.parseTreeData=function(e){var t,s=(t=e,JSON.parse(JSON.stringify(t))),n={},o={},r=[];return function e(t,s){t.forEach(function(t){n[t.id]=t,t.checked&&r.push(t.id),s&&(t.parent=s),t.children&&t.children.length?e(t.children,t):o[t.id]=t})}(s),{treeNodes:s,nodesById:n,leafNodesById:o,defaultValues:r}},r.createRootEle=function(){var e=document.createElement("div");return e.classList.add("treejs"),e},r.createUlEle=function(){var e=document.createElement("ul");return e.classList.add("treejs-nodes"),e},r.createLiEle=function(e){var t=document.createElement("li");if(t.classList.add("treejs-node"),e.children&&e.children.length){var s=document.createElement("span");s.classList.add("treejs-switcher"),t.appendChild(s)}else t.classList.add("treejs-placeholder");var n=document.createElement("span");n.classList.add("treejs-checkbox"),t.appendChild(n);var o=document.createTextNode(e.text);return t.appendChild(o),t.nodeId=e.id,t}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={method:"GET",url:"",async:!0,success:null,failed:null,"Content-Type":"application/json; charset=utf-8"},s=Object.assign(t,e),n=new XMLHttpRequest,o=[];for(var r in s.data)s.data.hasOwnProperty(r)&&o.push(r+"="+s.data[r]);var a=o.join("&");if("POST"===s.method.toUpperCase())n.open(s.method,s.url,s.async),n.setRequestHeader("Content-Type",s["Content-Type"]),n.send(a);else if("GET"===s.method.toUpperCase()){var i=s.url;a&&(-1!==i.indexOf("?")?i+="&"+a:i+="?"+a),n.open(s.method,i,s.async),n.setRequestHeader("Content-Type",s["Content-Type"]),n.send(null)}n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=n.responseText;s["Content-Type"]===t["Content-Type"]&&(e=JSON.parse(e)),s.success&&s.success(e)}else s.failed&&s.failed(n.status)}}},function(e,t,s){}]).default});
//# sourceMappingURL=tree.min.js.map